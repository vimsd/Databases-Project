<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Select Seat</title>
</head>
<body>

<h1>Select Seat</h1>
<ul id="seats"></ul>

<script>
const showtime_id = new URLSearchParams(location.search).get("showtime_id");

fetch(`http://127.0.0.1:5000/api/seats?showtime_id=${showtime_id}`)
  .then(r => r.json())
  .then(data => {
    const ul = document.getElementById("seats");
    data.forEach(s => {
      if (s.available) {
        ul.innerHTML += `
          <li>
            ${s.seat}
            <button onclick="book(${s.seat_id})">Book</button>
          </li>
        `;
      } else {
        ul.innerHTML += `<li>${s.seat} (Booked)</li>`;
      }
    });
  });

function book(seat_id) {
  fetch("http://127.0.0.1:5000/api/booking", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      user_id: 1,
      showtime_id: showtime_id,
      seat_id: seat_id,
      amount: 250
    })
  })
  .then(r => r.json())
  .then(res => {
    alert(res.message);
    location.reload();
  })
  .catch(() => alert("Booking failed"));
}
</script>

</body>
</html>
